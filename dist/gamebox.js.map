{"version":3,"sources":["src/assetloader.js","src/bezier-easing.js","src/index.js","src/input.js","src/key.js","src/log.js","src/loop.js","src/math/clamp.js","src/math/inverselerp.js","src/math/lerp.js","src/root.js","src/timer.js","src/tween.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjCA;AACA;AACA;AACA;AACA;AACA;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"dist/gamebox.js","sourcesContent":["udefine('gamebox/assetloader', ['root', 'eventmap', './log'], function(root, EventMap, Log) {\r\n\r\n  var audioTypes = {\r\n    'mp3': 'audio/mpeg',\r\n    'wav': 'audio/wav',\r\n    'ogg': 'audio/ogg'\r\n  };\r\n\r\n  var imageTypes = {\r\n    'png': 'image/png',\r\n    'jpg': 'image/jpg',\r\n    'gif': 'image/gif'\r\n  };\r\n\r\n  var AssetLoader = function(assets) {\r\n    EventMap.mixin(this, AssetLoader);\r\n\r\n    this.assets = assets || {};\r\n    this.files = {};\r\n\r\n    this.maxAssets = 0;\r\n    this.assetsLoaded = 0;\r\n    this.percentLoaded = 0;\r\n    this.cache = {};\r\n  };\r\n\r\n  AssetLoader.prototype.start = function() {\r\n    if (assets == null) {\r\n      return;\r\n    }\r\n\r\n    this.trigger('start');\r\n\r\n    var loadingProgress = function() {\r\n\r\n      var percentLoaded = 1;\r\n\r\n      if (currentProgress !== totalSize) {\r\n        percentLoaded = currentProgress / totalSize;\r\n      }\r\n\r\n      self.trigger('progress', percentLoaded);\r\n\r\n      if (currentProgress >= totalSize) {\r\n        self.trigger('complete');\r\n      }\r\n    };\r\n\r\n    var loadSuccess = function(iterator) {\r\n      return function() {\r\n        currentProgress += iterator.size;\r\n        self.assetsLoaded++;\r\n\r\n        loadingProgress();\r\n      };\r\n    };\r\n\r\n    var loadError = function(iterator) {\r\n      return function(err) {\r\n        Log.e('Error while loading ' + iterator.name + ': ' + err);\r\n      };\r\n    };\r\n\r\n    if (Object.keys(this.assets) > 0) {\r\n      Object.keys(this.assets).forEach(function(key) {\r\n        var value = this.assets[key];\r\n\r\n        if (value.files == null || !Array.isArray(value.files) || value.files.length === 0) {\r\n          return true;\r\n        }\r\n\r\n        self.maxAssets += value.files.length;\r\n\r\n        for (var i = 0, j = value.files.length; i < j; i++) {\r\n          (function(iterator) {\r\n            // Handle images here\r\n            if (iterator.type.indexOf('image') === 0) {\r\n              // TODO: Reflect: Does it make sense to put the cached images into an object?\r\n              var img = new root.Image();\r\n              img.onload = loadSuccess(iterator);\r\n              img.onerror = loadError(iterator);\r\n\r\n              img.src = iterator.name;\r\n            } else {\r\n              // Handle audio here\r\n              if (iterator.type.indexOf('audio') === 0) {\r\n                // TODO: Save preloaded files in the AudioManager\r\n                var audioType = iterator.name.split('.').pop();\r\n                var audio = new root.Audio();\r\n                if (supportedTypes[audioType] && audio.canPlayType(supportedTypes[audioType])) {\r\n                  audio.addEventListener('canplaythrough', loadSuccess(iterator));\r\n                  audio.onerror = loadError(iterator);\r\n\r\n                  audio.src = iterator.name;\r\n                  audio.load();\r\n                } else {\r\n                  Log.w('Skipped unsupported audio file (' + supportedTypes[audioType] + ') ' + iterator.name);\r\n                  loadSuccess(iterator)();\r\n                }\r\n              } else {\r\n                Log.w('Skipped file ' + iterator.name + ': Not an audio or image file');\r\n              }\r\n            }\r\n\r\n          })(value.files[i]);\r\n        }\r\n\r\n      }, this);\r\n    }\r\n  };\r\n\r\n  return AssetLoader;\r\n\r\n});\r\n","/**\n * BezierEasing - use bezier curve for transition easing function\n * by Gaëtan Renaudeau 2014 – MIT License\n *\n * Credits: is based on Firefox's nsSMILKeySpline.cpp\n * Usage:\n * var spline = BezierEasing(0.25, 0.1, 0.25, 1.0)\n * spline(x) => returns the easing value | x must be in [0, 1] range\n *\n */\n(function (definition) {\n  if (typeof exports === \"object\") {\n    module.exports = definition();\n  }\n  else if (typeof window.define === 'function' && window.define.amd) {\n    window.define('gamebox/bezier-easing', [], definition);\n  } else {\n    window.BezierEasing = definition();\n  }\n}(function () {\n  var global = this;\n\n  // These values are established by empiricism with tests (tradeoff: performance VS precision)\n  var NEWTON_ITERATIONS = 4;\n  var NEWTON_MIN_SLOPE = 0.001;\n  var SUBDIVISION_PRECISION = 0.0000001;\n  var SUBDIVISION_MAX_ITERATIONS = 10;\n\n  var kSplineTableSize = 11;\n  var kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);\n\n  var float32ArraySupported = 'Float32Array' in global;\n\n  function BezierEasing (mX1, mY1, mX2, mY2) {\n    // Validate arguments\n    if (arguments.length !== 4) {\n      throw new Error(\"BezierEasing requires 4 arguments.\");\n    }\n    for (var i=0; i<4; ++i) {\n      if (typeof arguments[i] !== \"number\" || isNaN(arguments[i]) || !isFinite(arguments[i])) {\n        throw new Error(\"BezierEasing arguments should be integers.\");\n      } \n    }\n    if (mX1 < 0 || mX1 > 1 || mX2 < 0 || mX2 > 1) {\n      throw new Error(\"BezierEasing x values must be in [0, 1] range.\");\n    }\n\n    var mSampleValues = float32ArraySupported ? new Float32Array(kSplineTableSize) : new Array(kSplineTableSize);\n   \n    function A (aA1, aA2) { return 1.0 - 3.0 * aA2 + 3.0 * aA1; }\n    function B (aA1, aA2) { return 3.0 * aA2 - 6.0 * aA1; }\n    function C (aA1)      { return 3.0 * aA1; }\n   \n    // Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.\n    function calcBezier (aT, aA1, aA2) {\n      return ((A(aA1, aA2)*aT + B(aA1, aA2))*aT + C(aA1))*aT;\n    }\n   \n    // Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.\n    function getSlope (aT, aA1, aA2) {\n      return 3.0 * A(aA1, aA2)*aT*aT + 2.0 * B(aA1, aA2) * aT + C(aA1);\n    }\n\n    function newtonRaphsonIterate (aX, aGuessT) {\n      for (var i = 0; i < NEWTON_ITERATIONS; ++i) {\n        var currentSlope = getSlope(aGuessT, mX1, mX2);\n        if (currentSlope === 0.0) return aGuessT;\n        var currentX = calcBezier(aGuessT, mX1, mX2) - aX;\n        aGuessT -= currentX / currentSlope;\n      }\n      return aGuessT;\n    }\n\n    function calcSampleValues () {\n      for (var i = 0; i < kSplineTableSize; ++i) {\n        mSampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);\n      }\n    }\n\n    function binarySubdivide (aX, aA, aB) {\n      var currentX, currentT, i = 0;\n      do {\n        currentT = aA + (aB - aA) / 2.0;\n        currentX = calcBezier(currentT, mX1, mX2) - aX;\n        if (currentX > 0.0) {\n          aB = currentT;\n        } else {\n          aA = currentT;\n        }\n      } while (Math.abs(currentX) > SUBDIVISION_PRECISION && ++i < SUBDIVISION_MAX_ITERATIONS);\n      return currentT;\n    }\n\n    function getTForX (aX) {\n      var intervalStart = 0.0;\n      var currentSample = 1;\n      var lastSample = kSplineTableSize - 1;\n\n      for (; currentSample != lastSample && mSampleValues[currentSample] <= aX; ++currentSample) {\n        intervalStart += kSampleStepSize;\n      }\n      --currentSample;\n\n      // Interpolate to provide an initial guess for t\n      var dist = (aX - mSampleValues[currentSample]) / (mSampleValues[currentSample+1] - mSampleValues[currentSample]);\n      var guessForT = intervalStart + dist * kSampleStepSize;\n\n      var initialSlope = getSlope(guessForT, mX1, mX2);\n      if (initialSlope >= NEWTON_MIN_SLOPE) {\n        return newtonRaphsonIterate(aX, guessForT);\n      } else if (initialSlope == 0.0) {\n        return guessForT;\n      } else {\n        return binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize);\n      }\n    }\n\n    var _precomputed = false;\n    function precompute() {\n      _precomputed = true;\n      if (mX1 != mY1 || mX2 != mY2)\n        calcSampleValues();\n    }\n\n    var f = function (aX) {\n      if (!_precomputed) precompute();\n      if (mX1 === mY1 && mX2 === mY2) return aX; // linear\n      // Because JavaScript number are imprecise, we should guarantee the extremes are right.\n      if (aX === 0) return 0;\n      if (aX === 1) return 1;\n      return calcBezier(getTForX(aX), mY1, mY2);\n    };\n\n    f.getControlPoints = function() { return [{ x: mX1, y: mY1 }, { x: mX2, y: mY2 }]; };\n    var str = \"BezierEasing(\"+[mX1, mY1, mX2, mY2]+\")\";\n    f.toString = function () { return str; };\n\n    return f;\n  }\n\n  // CSS mapping\n  BezierEasing.css = {\n    \"ease\":        BezierEasing(0.25, 0.1, 0.25, 1.0),\n    \"linear\":      BezierEasing(0.00, 0.0, 1.00, 1.0),\n    \"ease-in\":     BezierEasing(0.42, 0.0, 1.00, 1.0),\n    \"ease-out\":    BezierEasing(0.00, 0.0, 0.58, 1.0),\n    \"ease-in-out\": BezierEasing(0.42, 0.0, 0.58, 1.0)\n  };\n\n  return BezierEasing;\n\n}));\n","udefine('gamebox', ['gameboard/assetloader', 'gameboard/input', 'gameboard/loop', 'gameboard/log', 'gameboard/timer'], function(AssetLoader, Input, Loop, Log, Timer) {\r\n  \r\n  return {\r\n    AssetLoader: AssetLoader,\r\n    Input: Input,\r\n    Loop: Loop,\r\n    Log: Log,\r\n    Timer: Timer\r\n  };\r\n  \r\n});\r\n","udefine('gamebox/input', ['root', 'eventmap', 'gameboard/key'], function(root, EventMap, Key) {\r\n\r\n  var Input = {};\r\n\r\n  Input.define = Key.define;\r\n  Input.key = new EventMap();\r\n\r\n  root.addEventListener('keydown', function(evt) {\r\n    Input.key.trigger({\r\n      name: 'down',\r\n      context: Key\r\n    }, evt.keyCode);\r\n  }, true);\r\n  \r\n  root.addEventListener('keyup', function(evt) {\r\n    Input.key.trigger({\r\n      name: 'up',\r\n      context: Key\r\n    }, evt.keyCode);\r\n  }, true);\r\n\r\n  return Input;\r\n});\r\n","udefine('gamebox/key', function() {\r\n  'use strict';\r\n  \r\n  var Key = {\r\n    'backspace': 8,\r\n    'tab': 9,\r\n    'enter': 13,\r\n    'shift': 16,\r\n    'ctrl': 17,\r\n    'alt': 18,\r\n    'escape': 27,\r\n    'left': 37,\r\n    'up': 38,\r\n    'right': 39,\r\n    'down': 40,\r\n    'insert': 45,\r\n    'delete': 46,\r\n    '0': 48,\r\n    '1': 49,\r\n    '2': 50,\r\n    '3': 51,\r\n    '4': 52,\r\n    '5': 53,\r\n    '6': 54,\r\n    '7': 55,\r\n    '8': 56,\r\n    '9': 57,\r\n    'a': 65,\r\n    'b': 66,\r\n    'c': 67,\r\n    'd': 68,\r\n    'e': 69,\r\n    'f': 70,\r\n    'g': 71,\r\n    'h': 72,\r\n    'i': 73,\r\n    'j': 74,\r\n    'k': 75,\r\n    'l': 76,\r\n    'm': 77,\r\n    'n': 78,\r\n    'o': 79,\r\n    'p': 80,\r\n    'q': 81,\r\n    'r': 82,\r\n    's': 83,\r\n    't': 84,\r\n    'u': 85,\r\n    'v': 86,\r\n    'w': 87,\r\n    'x': 88,\r\n    'y': 89,\r\n    'z': 90,\r\n    'numpad0': 96,\r\n    'numpad1': 97,\r\n    'numpad2': 98,\r\n    'numpad3': 99,\r\n    'numpad4': 100,\r\n    'numpad5': 101,\r\n    'numpad6': 102,\r\n    'numpad7': 103,\r\n    'numpad8': 104,\r\n    'numpad9': 105,\r\n    'f1': 112,\r\n    'f2': 113,\r\n    'f3': 114,\r\n    'f4': 115,\r\n    'f5': 116,\r\n    'f6': 117,\r\n    'f7': 118,\r\n    'f8': 119,\r\n    'f9': 120,\r\n    'f10': 121,\r\n    'f11': 122,\r\n    'f12': 123,\r\n    'semiColon': 186,\r\n    'equalSign': 187,\r\n    'comma': 188,\r\n    'dash': 189,\r\n    'period': 190,\r\n    'forwardSlash': 191,\r\n    'openBracket': 219,\r\n    'backSlash': 220,\r\n    'closeBraket': 221,\r\n    'singleQuote': 222\r\n  };\r\n  \r\n  Key.define = function(name, key) {\r\n    if (name == null || key == null) {\r\n      return;\r\n    }\r\n    \r\n    if (!Object.hasOwnProperty.call(Key, name)) {\r\n      if (typeof key === 'function') {\r\n        Object.defineProperty(Key, name, {\r\n          get: key\r\n        });\r\n      } else {\r\n        Key[name] = key;        \r\n      }\r\n    }\r\n  };\r\n\r\n  return Key;\r\n\r\n});","define('gamebox/log', ['root'], function(root) {\r\n  'use strict';\r\n  /**\r\n   * @module gameboard/log\r\n   * @requires root\r\n   */\r\n  \r\n  /**\r\n   * @class\r\n   * @alias module:gameboard/log\r\n   */\r\n  var Log = (function() {\r\n\r\n    var Log = {};\r\n\r\n    Log.connector = null;\r\n\r\n    Log.plugins = {};\r\n\r\n    Log.plugins.console = {\r\n      e: function() {\r\n        if (root.console && root.console.error) {\r\n          return root.console.error.apply(console, arguments);\r\n        }\r\n      },\r\n      w: function() {\r\n        if (root.console && root.console.warn) {\r\n          return root.console.warn.apply(console, arguments);\r\n        }\r\n      },\r\n      i: function() {\r\n        if (root.console && root.console.info) {\r\n          return root.console.info.apply(console, arguments);\r\n        }\r\n      },\r\n      d: function() {\r\n        if (root.console && root.console.log) {\r\n          return root.console.log.apply(console, arguments);\r\n        }\r\n      },\r\n      v: function() {\r\n        if (root.console && root.console.log) {\r\n          return root.console.log.apply(console, arguments);\r\n        }\r\n      }\r\n    };\r\n\r\n    Log.connector = Log.plugins.console;\r\n\r\n    Log.logLevelMap = {\r\n      'error': ['e'],\r\n      'warn': ['w', 'e'],\r\n      'info': ['i', 'w', 'e'],\r\n      'debug': ['d', 'i', 'w', 'e'],\r\n      'verbose': ['v', 'd', 'i', 'w', 'e']\r\n    };\r\n\r\n    Log.logLevel = 'verbose';\r\n\r\n    var logFunctions = ['v', 'd', 'i', 'w', 'e'];\r\n\r\n    for (var i = 0, j = logFunctions.length; i < j; i++) {\r\n\r\n      (function(iterator) {\r\n        Log[iterator] = function() {\r\n          if (Log.logLevelMap[Log.logLevel].indexOf(iterator) >= 0) {\r\n            Log.connector[iterator].apply(this, arguments);\r\n          }\r\n        };        \r\n      })(logFunctions[i]);\r\n      \r\n    }\r\n\r\n    return Log;\r\n\r\n  })();\r\n\r\n  return Log;\r\n});","udefine('gamebox/loop', ['requestanimationframe', 'eventmap', 'performance', './timer'], function(requestAnimationFrame, EventMap, performance, Timer) {\r\n  \r\n  /**\r\n   * @module gameboard/loop\r\n   */\r\n  \r\n  'use strict';\r\n  \r\n  var loopEvents = new EventMap();\r\n  var pausedEvents = {};\r\n  var timers = [];\r\n  \r\n  /**\r\n   * @class Loop\r\n   * @static \r\n   */\r\n  return (function() {\r\n\r\n    var isRunning = true;\r\n\r\n    /**\r\n     * @method run \r\n     */\r\n    var run = function() {\r\n      var time;\r\n\r\n      (function loop() {\r\n        requestAnimationFrame(loop);\r\n\r\n        var now = performance.now();\r\n        var dt = now - (time || now);\r\n\r\n        time = now;\r\n\r\n        if (!isRunning) {\r\n          return;\r\n        }\r\n        \r\n        timers.forEach(function(timer) {\r\n          timer.tick(now);\r\n        });\r\n\r\n        var eventKeys = Object.keys(loopEvents.events.listeners);\r\n        \r\n        for (var i = 0, j = eventKeys.length; i < j; i++) {\r\n          (function(key) {\r\n            if (!pausedEvents[key]) {\r\n              loopEvents.trigger(key, dt);\r\n            }\r\n          })(eventKeys[i]);\r\n        }\r\n      })();\r\n    };\r\n\r\n    /**\r\n     * @method stop \r\n     */\r\n    var stop = function() {\r\n      isRunning = false;\r\n    };\r\n\r\n    var clear = function() {\r\n      loopEvents.clear();\r\n      pausedEvents = {};\r\n    };\r\n    \r\n    var on = function(taskName, taskFunction) {\r\n      loopEvents.on(taskName, taskFunction);\r\n      pausedEvents[taskName] = false;\r\n    };\r\n    \r\n    var off = function(taskName) {\r\n      loopEvents.off(taskName);\r\n      if (pausedEvents[taskName] != null) {\r\n        delete pausedEvents[taskName];        \r\n      }\r\n    };\r\n\r\n    var pause = function(taskName) {\r\n      pausedEvents[taskName] = true;\r\n    };\r\n\r\n    var resume = function(taskName) {\r\n      if (taskName == null) {\r\n        isRunning = true;\r\n        return;\r\n      }\r\n      \r\n      pausedEvents[taskName] = false;\r\n    };\r\n    \r\n    var createTimer = function(interval) {\r\n      var timer = new Timer(interval);\r\n      timers.push(timer);\r\n      \r\n      return timer;\r\n    };\r\n\r\n\r\n    return {\r\n      run: run,\r\n      \r\n      stop: stop,\r\n      clear: clear,\r\n      \r\n      on: on,\r\n      off: off,\r\n      \r\n      pause: pause,\r\n      resume: resume,\r\n      \r\n      createTimer: createTimer\r\n    };\r\n  })();\r\n  \r\n});\r\n","udefine('clamp', function() {\r\n  'use strict';\r\n  \r\n  var clamp = function(value, min, max) {\r\n    var _ref, _ref1, _ref2;\r\n    if ( typeof value === 'object') {\r\n      _ref = value, min = _ref.min, max = _ref.max, value = _ref.value;\r\n    }\r\n    if (Array.isArray(min)) {\r\n      _ref1 = min, min = _ref1[0], max = _ref1[1];\r\n    }\r\n    if (min == null) {\r\n      min = 0.0;\r\n    }\r\n    if (max == null) {\r\n      max = 1.0;\r\n    }\r\n    if (min > max) {\r\n      _ref2 = [max, min], min = _ref2[0], max = _ref2[1];\r\n    }\r\n    if ((min <= value && value <= max)) {\r\n      return value;\r\n    } else {\r\n      if (value > max) {\r\n        return max;\r\n      } else {\r\n        return min;\r\n      }\r\n    }\r\n  };\r\n\r\n  return clamp;\r\n});\r\n","udefine('inverselerp', ['lerp'], function(lerp) {\r\n\treturn function(min, max, amt) {\r\n\t\treturn max - lerp(min, max, amt);\r\n\t};\r\n});\r\n","udefine('lerp', ['clamp'], function(clamp) {\r\n\treturn function(min, max, amt) {\r\n    var tmpAmt = clamp(amt, 0.0, 1.0);\r\n    var diff = Math.abs(max - min);\r\n    \r\n    if (diff === 0) {\r\n    \treturn min;\r\n    } else {\r\n    \treturn min + (diff * tmpAmt);\r\n    }\r\n\t};\r\n});\r\n","(function(root) {\r\n  'use strict';\r\n  \r\n  define('root', function() {\r\n    return root;\r\n  });\r\n})(this);","udefine('gamebox/timer', ['eventmap', 'performance'], function(EventMap, performance) {\r\n\r\n  var Timer = function(interval) {\r\n    EventMap.mixin(this, Timer.prototype);\r\n    \r\n    var self = this;\r\n\r\n    this.interval = interval || 1000;\r\n    this.startTime = -1;\r\n\r\n    this.active = false;\r\n    this.paused = false;\r\n\r\n    var oldTicks = 0;\r\n\r\n    this.tick = function(currentTime) {\r\n      if (!self.active || self.paused) {\r\n        return;\r\n      }\r\n      \r\n      if (interval <= 0) {\r\n        return;\r\n      }\r\n\r\n      self.trigger('tick', currentTime);\r\n\r\n      if ((currentTime - self.startTime - self.interval) > oldTicks) {\r\n        oldTicks = currentTime;\r\n        self.trigger('interval');\r\n      }\r\n    };\r\n  };\r\n\r\n  Timer.prototype.start = function() {\r\n    this.active = true;\r\n    this.paused = false;\r\n\r\n    this.startTime = performance.now();\r\n\r\n    this.trigger('start');\r\n  };\r\n\r\n  Timer.prototype.pause = function() {\r\n    this.paused = true;\r\n\r\n    this.trigger('pause');\r\n  };\r\n\r\n  Timer.prototype.unpause = function() {\r\n    this.paused = false;\r\n\r\n    this.trigger('unpause');\r\n  };\r\n\r\n  Timer.prototype.stop = function() {\r\n    this.paused = false;\r\n    this.active = false;\r\n\r\n    this.trigger('stop');\r\n  };\r\n  \r\n  return Timer;\r\n\r\n});\r\n","udefine('gamebox/tween', ['eventmap', './bezier-easing', './loop'], function(EventMap, BezierEasing, Loop) {\r\n\r\n  var Tween = function() {\r\n    EventMap.mixin(this, Tween.prototype);\r\n    \r\n    this.target = null;\r\n  };\r\n\r\n  Tween.prototype.animate = function(property, end, time, easing) {\r\n    var self = this;\r\n    \r\n    if (this.target && typeof this.target[property] === 'number') {\r\n      var start = this.target[property];\r\n      \r\n      if (start === end) {\r\n        this.trigger('start');\r\n        this.trigger('end');\r\n        return;\r\n      }\r\n      \r\n      easing = easing || 'linear';\r\n\r\n      var timer = Loop.createTimer();\r\n      \r\n      timer.interval = time;\r\n      \r\n      timer.on('start', function() {\r\n        self.trigger('start');\r\n      });\r\n      \r\n      timer.start();\r\n      \r\n      timer.on('tick', function(ticks) {\r\n        var multiplicator = BezierEasing.css[easing](ticks / (timer.startTime + timer.interval));\r\n        var points = (end - start) * multiplicator;\r\n        \r\n        if (points > end) {\r\n          points = end;\r\n        }\r\n        \r\n        self.target[property] = points;\r\n        self.trigger('animate', points);\r\n      });\r\n      \r\n      timer.on('interval', function() {\r\n        timer.stop();\r\n        self.target[property] = end;\r\n        self.trigger('end');\r\n      });\r\n\r\n    }\r\n  };\r\n\r\n  return Tween;\r\n\r\n});\r\n"]}